

# sudo apt install ???
# ninja -f ./resources/native.ninja


cpp = clang++-12
ld = clang++-12 -fuse-ld=lld
ar = llvm-ar-12

cflags = -c -g -O3 -flto -I ./library/ -Werror -Wall -Wextra -Wconversion -pedantic -Wold-style-cast
cflags_tools = -c -g -O3 -flto -I ./library/ -I ./tools/thirdparty/lodepng/ -I ./tools/thirdparty/CLI11/include/


rule Compile
 command = $cpp $cflags $in -o $out
rule CompileTool
 command = $cpp $cflags_tools $in -o $out
rule Pack
 command = $ar -rcs $out $in
rule Link
 command = $ld $in -o $out


build ./build/native/library/common/conversions.o: Compile ./library/common/conversions.cpp
build ./build/native/library/common/defaults.o:    Compile ./library/common/defaults.cpp
build ./build/native/library/common/essentials.o:  Compile ./library/common/essentials.cpp
build ./build/native/library/common/utilities.o:   Compile ./library/common/utilities.cpp
build ./build/native/library/common/version.o:     Compile ./library/common/version.cpp

build ./build/native/library/decode/compression.o:   Compile ./library/decode/compression.cpp
build ./build/native/library/decode/decode.o:        Compile ./library/decode/decode.cpp
build ./build/native/library/decode/format.o:        Compile ./library/decode/format.cpp
build ./build/native/library/decode/heads.o:         Compile ./library/decode/heads.cpp
build ./build/native/library/decode/lifting.o:       Compile ./library/decode/lifting.cpp
build ./build/native/library/decode/wavelet-cdf53.o: Compile ./library/decode/wavelet-cdf53.cpp
build ./build/native/library/decode/wavelet-haar.o:  Compile ./library/decode/wavelet-haar.cpp

build ./build/native/library/encode/compression.o:   Compile ./library/encode/compression.cpp
build ./build/native/library/encode/encode.o:        Compile ./library/encode/encode.cpp
build ./build/native/library/encode/format.o:        Compile ./library/encode/format.cpp
build ./build/native/library/encode/heads.o:         Compile ./library/encode/heads.cpp
build ./build/native/library/encode/lifting.o:       Compile ./library/encode/lifting.cpp
build ./build/native/library/encode/wavelet-cdf53.o: Compile ./library/encode/wavelet-cdf53.cpp
build ./build/native/library/encode/wavelet-haar.o:  Compile ./library/encode/wavelet-haar.cpp

build ./build/native/tests/forward-backward.o: Compile ./tests/forward-backward.cpp
build ./build/native/tests/wavelet-cdf53.o:    Compile ./tests/wavelet-cdf53.cpp
build ./build/native/tests/wavelet-haar.o:     Compile ./tests/wavelet-haar.cpp

build ./build/native/tools/akodec.o:           CompileTool ./tools/akodec.cpp
build ./build/native/tools/akoenc.o:           CompileTool ./tools/akoenc.cpp
build ./build/native/tools/common/adler32.o:   CompileTool ./tools/common/adler32.cpp
build ./build/native/tools/common/callbacks.o: CompileTool ./tools/common/callbacks.cpp
build ./build/native/tools/common/developer.o: CompileTool ./tools/common/developer.cpp
build ./build/native/tools/common/png.o:       CompileTool ./tools/common/png.cpp

build ./build/native/tools/thirdparty/CLI11/src/Precompile.o: CompileTool ./tools/thirdparty/CLI11/src/Precompile.cpp
build ./build/native/tools/thirdparty/lodepng/lodepng.o:      CompileTool ./tools/thirdparty/lodepng/lodepng.cpp


build ./build/native-libako-static.a: Pack $
 ./build/native/library/common/conversions.o $
 ./build/native/library/common/defaults.o $
 ./build/native/library/common/essentials.o $
 ./build/native/library/common/utilities.o $
 ./build/native/library/common/version.o $
 ./build/native/library/decode/compression.o $
 ./build/native/library/decode/decode.o $
 ./build/native/library/decode/format.o $
 ./build/native/library/decode/heads.o $
 ./build/native/library/decode/lifting.o $
 ./build/native/library/decode/wavelet-cdf53.o $
 ./build/native/library/decode/wavelet-haar.o $
 ./build/native/library/encode/compression.o $
 ./build/native/library/encode/encode.o $
 ./build/native/library/encode/format.o $
 ./build/native/library/encode/heads.o $
 ./build/native/library/encode/lifting.o $
 ./build/native/library/encode/wavelet-cdf53.o $
 ./build/native/library/encode/wavelet-haar.o

build ./build/native-tools-common.a: Pack $
 ./build/native/tools/common/adler32.o $
 ./build/native/tools/common/callbacks.o $
 ./build/native/tools/common/developer.o $
 ./build/native/tools/common/png.o $
 ./build/native/tools/thirdparty/CLI11/src/Precompile.o $
 ./build/native/tools/thirdparty/lodepng/lodepng.o

build ./build/native-test-forward-backward: Link $
 ./build/native/tests/forward-backward.o $
 ./build/native-libako-static.a

build ./build/native-test-wavelet-cdf53: Link $
 ./build/native/tests/wavelet-cdf53.o $
 ./build/native-libako-static.a

build ./build/native-test-wavelet-haar: Link $
 ./build/native/tests/wavelet-haar.o $
 ./build/native-libako-static.a

build ./build/native-akodec: Link $
 ./build/native/tools/akodec.o $
 ./build/native-tools-common.a $
 ./build/native-libako-static.a

build ./build/native-akoenc: Link $
 ./build/native/tools/akoenc.o $
 ./build/native-tools-common.a $
 ./build/native-libako-static.a
